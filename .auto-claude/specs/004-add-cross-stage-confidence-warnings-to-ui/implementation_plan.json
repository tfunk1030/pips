{
  "feature": "Add Cross-Stage Confidence Warnings to UI",
  "description": "Display the confidence hints generated by generateConfidenceHints() in the mobile app's extraction results screen. The backend already computes these hints but the UI only shows the overall confidence percentage.",
  "created_at": "2025-12-22T07:00:52.959Z",
  "updated_at": "2025-12-22T07:15:00.000Z",
  "status": "in_progress",
  "planStatus": "approved",
  "phases": [
    {
      "phase_id": "phase-1",
      "name": "Create Extraction Pipeline with Confidence Tracking",
      "description": "Build the pipeline infrastructure that computes confidence scores and generates human-readable hints for each extraction stage",
      "order": 1,
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "1.1",
          "title": "Create pipeline types and interfaces",
          "description": "Define TypeScript types for ExtractionStage, StageConfidence, ConfidenceHint, and ExtractionResult with confidence metadata",
          "status": "pending",
          "file_path": "src/extraction/types.ts",
          "acceptance_criteria": [
            "ExtractionStage enum with stages: BOARD_DETECTION, GRID_ALIGNMENT, CELL_EXTRACTION, PIP_RECOGNITION",
            "StageConfidence interface with stage, confidence (0-1), method, and optional details",
            "ConfidenceHint interface with stage, severity (low/medium/high), message, and suggestion",
            "ExtractionResult interface including stageConfidences array and hints array"
          ]
        },
        {
          "subtask_id": "1.2",
          "title": "Implement generateConfidenceHints function",
          "description": "Create the core function that analyzes stage confidences and generates human-readable warning hints",
          "status": "pending",
          "file_path": "src/extraction/pipeline.ts",
          "acceptance_criteria": [
            "Function takes StageConfidence[] as input and returns ConfidenceHint[]",
            "Generates 'Low confidence in X' hints when stage confidence < 0.7",
            "Generates 'Extraction confidence varies significantly across stages' when variance > 0.15",
            "Generates specific suggestions for each type of low-confidence scenario"
          ]
        },
        {
          "subtask_id": "1.3",
          "title": "Create mock extraction results for testing",
          "description": "Create sample extraction results with various confidence levels for development and testing",
          "status": "pending",
          "file_path": "src/extraction/mockData.ts",
          "acceptance_criteria": [
            "High confidence scenario (all stages > 0.9)",
            "Low single-stage confidence scenario",
            "High variance across stages scenario",
            "Mixed scenario with multiple warnings"
          ]
        }
      ]
    },
    {
      "phase_id": "phase-2",
      "name": "Build UI Components for Confidence Display",
      "description": "Create React Native components to display confidence warnings and hints in the extraction results screen",
      "order": 2,
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "2.1",
          "title": "Create ConfidenceIndicator component",
          "description": "A visual indicator component showing overall confidence as a percentage with color-coded severity",
          "status": "pending",
          "file_path": "src/app/components/ui/ConfidenceIndicator.tsx",
          "acceptance_criteria": [
            "Displays confidence as percentage (e.g., '85%')",
            "Color coding: green (>80%), yellow (60-80%), red (<60%)",
            "Optional compact mode for inline display",
            "Animated transition when confidence value changes"
          ]
        },
        {
          "subtask_id": "2.2",
          "title": "Create ConfidenceHintsList component",
          "description": "A list component that displays individual confidence warning hints with appropriate icons and styling",
          "status": "pending",
          "file_path": "src/app/components/ui/ConfidenceHintsList.tsx",
          "acceptance_criteria": [
            "Renders list of ConfidenceHint objects",
            "Severity-based icons (warning triangle, info circle)",
            "Collapsible details showing suggestions",
            "Proper accessibility labels for screen readers"
          ]
        },
        {
          "subtask_id": "2.3",
          "title": "Create ConfidenceSummary composite component",
          "description": "A composite component combining the overall indicator with the hints list in a card layout",
          "status": "pending",
          "file_path": "src/app/components/ui/ConfidenceSummary.tsx",
          "acceptance_criteria": [
            "Combines ConfidenceIndicator and ConfidenceHintsList",
            "Card-style container with shadow and rounded corners",
            "Shows 'No warnings' state when hints array is empty",
            "Expandable/collapsible behavior for mobile ergonomics"
          ]
        }
      ]
    },
    {
      "phase_id": "phase-3",
      "name": "Create Extraction Results Screen",
      "description": "Build the screen that displays extraction results including confidence warnings",
      "order": 3,
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "3.1",
          "title": "Create ExtractionResultScreen",
          "description": "A new screen to show the results of image extraction including the puzzle grid preview and confidence summary",
          "status": "pending",
          "file_path": "src/app/screens/ExtractionResultScreen.tsx",
          "acceptance_criteria": [
            "Displays extracted puzzle grid preview",
            "Shows ConfidenceSummary component with all hints",
            "Provides 'Accept & Solve' and 'Retry Extraction' actions",
            "Shows individual stage confidence breakdown on request"
          ]
        },
        {
          "subtask_id": "3.2",
          "title": "Add navigation route for ExtractionResultScreen",
          "description": "Register the new screen in the navigation stack and define route parameters",
          "status": "pending",
          "file_path": "src/app/navigation/RootNavigator.tsx",
          "acceptance_criteria": [
            "Add ExtractionResult to RootStackParamList",
            "Route params include extractionResult with puzzle and confidence data",
            "Navigation flows from image capture to extraction result to solve"
          ]
        }
      ]
    },
    {
      "phase_id": "phase-4",
      "name": "Integration and Testing",
      "description": "Integrate all components and ensure proper functionality across the app",
      "order": 4,
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "4.1",
          "title": "Wire up extraction pipeline to UI",
          "description": "Connect the pipeline's generateConfidenceHints to the ExtractionResultScreen",
          "status": "pending",
          "file_path": "src/app/screens/ExtractionResultScreen.tsx",
          "acceptance_criteria": [
            "ExtractionResultScreen receives and displays real confidence data",
            "Hints update correctly when extraction is retried",
            "Loading states shown during extraction processing"
          ]
        },
        {
          "subtask_id": "4.2",
          "title": "Add unit tests for generateConfidenceHints",
          "description": "Write comprehensive tests for the confidence hints generation logic",
          "status": "pending",
          "file_path": "src/extraction/__tests__/pipeline.test.ts",
          "acceptance_criteria": [
            "Tests for low confidence detection at each stage",
            "Tests for variance calculation and thresholds",
            "Tests for hint message formatting",
            "Edge cases: empty input, all zeros, all ones"
          ]
        },
        {
          "subtask_id": "4.3",
          "title": "Manual integration testing with mock data",
          "description": "Test the full flow from extraction to display using the mock data scenarios",
          "status": "pending",
          "file_path": null,
          "acceptance_criteria": [
            "All four mock scenarios display correctly",
            "Navigation between screens works properly",
            "UI responds appropriately to different hint counts",
            "Accessibility features work with screen reader"
          ]
        }
      ]
    }
  ],
  "workflow_type": "development",
  "services_involved": [
    "pips-solver mobile app (React Native)",
    "extraction pipeline module"
  ],
  "final_acceptance": [
    "ConfidenceSummary component displays human-readable confidence hints",
    "generateConfidenceHints produces appropriate warnings for low-confidence stages",
    "Users can see specific warnings like 'Low confidence in Grid dimensions'",
    "Variance warnings appear when extraction confidence varies significantly across stages",
    "All components follow existing codebase patterns and styling"
  ],
  "spec_file": "spec.md",
  "estimated_effort": "small",
  "notes": "The spec referenced existing code (pipeline.ts lines 236-282, ConfidenceSummary component) that does not exist in any branch. This plan creates all necessary infrastructure from scratch, following the patterns established in the codex branch."
}
