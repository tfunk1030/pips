{
  "task_description": "# Enhanced OCR Constraint Detection\n\nImprove OCR accuracy for reading constraint numbers and text from puzzle screenshots. Currently OCR struggles with various fonts, sizes, and image qualities.\n\n## Rationale\nConstraint detection is critical for puzzle solving. Users currently experience failures when constraints aren't read correctly, requiring manual correction. Improving OCR directly addresses the pain point of 40-60% detection accuracy on complex puzzles.\n\n## User Stories\n- As a puzzle enthusiast, I want the app to correctly read constraint numbers so that I get accurate solutions\n- As a mobile user, I want OCR to work reliably with my phone's screenshot quality so that I don't have to retake photos\n\n## Acceptance Criteria\n- [ ] OCR correctly reads constraint numbers in 90%+ of standard puzzle screenshots\n- [ ] OCR handles different font sizes and styles\n- [ ] OCR works with both high and low resolution images\n- [ ] Preprocessing pipeline optimizes images for text recognition\n",
  "scoped_services": ["pips-agent"],
  "files_to_modify": {
    "pips-agent": [
      "utils/ocr_helper.py"
    ]
  },
  "files_to_reference": [
    "pips-agent/utils/ocr_helper.py",
    "pips-agent/tools/ocr_constraints.py",
    "cv-service/main.py"
  ],
  "patterns": {
    "ocr_baseline": "Current preprocessing: grayscale → OTSU thresholding → pytesseract.image_to_string() with no PSM config or character whitelisting",
    "module_structure": "Utilities in utils/ directory, tools in tools/ directory that import from utils",
    "debug_output": "Uses DEBUG_OUTPUT_DIR environment variable for intermediate image outputs",
    "testing_pattern": "Root-level test files (test_*.py) in service directories",
    "opencv_usage": "OpenCV (cv2) for image processing, numpy for array operations"
  },
  "existing_implementations": {
    "description": "Basic OCR preprocessing in pips-agent/utils/ocr_helper.py using grayscale conversion and OTSU thresholding only. No advanced preprocessing or Tesseract configuration.",
    "relevant_files": [
      "pips-agent/utils/ocr_helper.py",
      "pips-agent/tools/ocr_constraints.py",
      "pips-agent/requirements.txt"
    ],
    "limitations": "No PSM mode customization, no character whitelisting, no upscaling for low-res images, no denoising, no CLAHE contrast enhancement, no morphological operations"
  },
  "created_at": "2025-12-22T03:20:20.772622"
}
