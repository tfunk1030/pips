{
  "task_description": "Enhance AI extraction accuracy for NYT Pips puzzle board with improved prompts, validation, CV preprocessing, and user verification UI",
  "scoped_services": ["pips-solver", "cv-service"],
  "files_to_modify": {
    "pips-solver": [
      "src/services/aiExtraction.ts",
      "src/services/extraction/pipeline.ts",
      "src/services/extraction/stages/gridGeometry.ts",
      "src/services/extraction/stages/cellDetection.ts",
      "src/services/extraction/stages/regionMapping.ts",
      "src/services/extraction/stages/constraintExtraction.ts",
      "src/services/extraction/stages/dominoExtraction.ts",
      "src/services/extraction/validation/gridValidator.ts",
      "src/services/cvExtraction.ts",
      "src/app/components/AIVerificationModal.tsx",
      "src/app/screens/OverlayBuilderScreen.tsx"
    ],
    "cv-service": [
      "main.py",
      "hybrid_extraction.py"
    ]
  },
  "files_to_reference": [
    "pips-solver/src/services/extractionSchemas.ts",
    "pips-solver/src/services/jsonParsingUtils.ts",
    "pips-solver/src/services/ensembleExtraction.ts",
    "pips-solver/src/model/overlayTypes.ts",
    "pips-solver/src/services/extraction/types.ts",
    "pips-solver/src/services/extraction/config.ts"
  ],
  "patterns": {
    "extraction_pipeline": "5-stage pipeline with context passing: Grid → Cells → Regions → Constraints → Dominoes",
    "consensus_voting": "3-model ensemble with confidence-weighted voting (80% grid threshold, 70% regions)",
    "zod_validation": "Use safeParse() for all AI responses with schema validation",
    "json_parsing": "Use parseJSONWithFallback() to handle multiline strings in shape/regions",
    "progress_callback": "Use ProgressCallback type to report stage progress with confidence scores",
    "retry_logic": "Retry with clarifying prompt when models disagree or fewer than 2 valid responses"
  },
  "existing_implementations": {
    "description": "Complete 5-stage extraction pipeline exists with multi-model ensemble. Issues: inaccurate grid detection, incorrect region mapping, constraint extraction failures, domino pip miscounting",
    "relevant_files": [
      "pips-solver/src/services/extraction/pipeline.ts",
      "pips-solver/src/services/extraction/stages/gridGeometry.ts",
      "pips-solver/src/services/extraction/stages/cellDetection.ts",
      "pips-solver/src/services/extraction/stages/regionMapping.ts",
      "pips-solver/src/services/extraction/stages/constraintExtraction.ts",
      "pips-solver/src/services/extraction/stages/dominoExtraction.ts"
    ]
  },
  "known_issues": [
    "Grid dimension detection often incorrect (rows/cols swapped or miscounted)",
    "Cell vs hole detection has false positives/negatives",
    "Region color mapping fails with similar adjacent colors",
    "Constraint extraction misses diamond labels or reads wrong values",
    "Domino pip counting inaccurate especially for 4-6 pips"
  ],
  "tech_stack": {
    "pips-solver": {
      "language": "TypeScript",
      "framework": "React Native + Expo SDK v54",
      "libraries": ["expo-image-picker", "expo-file-system", "react-native-svg", "zod"],
      "dev_command": "npm run start",
      "port": 8081
    },
    "cv-service": {
      "language": "Python",
      "framework": "FastAPI",
      "libraries": ["opencv-python", "numpy", "pydantic"],
      "dev_command": "uvicorn main:app --host 0.0.0.0 --port 8080 --reload",
      "port": 8080
    }
  },
  "created_at": "2025-12-21T23:45:00.000Z"
}
