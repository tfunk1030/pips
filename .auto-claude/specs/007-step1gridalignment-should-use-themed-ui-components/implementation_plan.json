{
  "feature": "Step1GridAlignment should use themed UI components",
  "description": "Refactor Step1GridAlignment screen to use the established Button, Card, and Text components from the UI library instead of raw TouchableOpacity and inline StyleSheet styles. This improves consistency, accessibility, and maintainability.",
  "created_at": "2025-12-22T07:01:11.961Z",
  "updated_at": "2025-12-22T08:00:00.000Z",
  "status": "completed",
  "planStatus": "approved",
  "workflow_type": "development",
  "services_involved": ["pips-solver"],
  "spec_file": "spec.md",
  "phases": [
    {
      "phase_id": "phase-1",
      "name": "Setup and Analysis",
      "description": "Merge required UI components and analyze current implementation",
      "status": "completed",
      "subtasks": [
        {
          "subtask_id": "subtask-1-1",
          "title": "Merge UI component library from branch 001",
          "description": "The UI components (Button, Card, Text, etc.) exist in branch auto-claude/001-enhance-ai-visual-pips-board-extraction-accuracy. Merge or cherry-pick the theme system and UI components into this branch to make them available for the refactoring.",
          "status": "completed",
          "completion_notes": "UI components and theme system already exist in branch. Verified: Button (primary/secondary/ghost/danger/success variants), Card (default/elevated/outlined/accent variants), Text/Heading/Body/Label components, full theme system with colors/spacing/radii/shadows/animations.",
          "files_to_modify": [],
          "files_to_create": [
            "pips-solver/src/theme/index.ts",
            "pips-solver/src/theme/tokens.ts",
            "pips-solver/src/theme/fonts.ts",
            "pips-solver/src/theme/animations.ts",
            "pips-solver/src/theme/ThemeContext.tsx",
            "pips-solver/src/theme/styled.ts",
            "pips-solver/src/app/components/ui/Button.tsx",
            "pips-solver/src/app/components/ui/Card.tsx",
            "pips-solver/src/app/components/ui/Text.tsx",
            "pips-solver/src/app/components/ui/index.ts"
          ],
          "dependencies": [],
          "acceptance_criteria": [
            "Theme system is available with colors, spacing, radii, shadows",
            "Button component with variants (primary, secondary, ghost) is available",
            "Text components (Text, Heading, Body, Label) are available",
            "Card component with variants is available",
            "UI components can be imported from '../components/ui'"
          ],
          "notes": "This is a prerequisite - the UI library must be available before refactoring can begin"
        }
      ]
    },
    {
      "phase_id": "phase-2",
      "name": "Replace Button Components",
      "description": "Replace all TouchableOpacity-based buttons with themed Button components",
      "status": "completed",
      "subtasks": [
        {
          "subtask_id": "subtask-2-1",
          "title": "Replace pickButton with themed Button",
          "description": "Replace the 'Select Image' TouchableOpacity button in the empty state with Button component using variant='primary'.",
          "status": "completed",
          "completion_notes": "Already completed. The 'Select Image' button in the empty state uses Button component with variant='primary'. Committed as e03633d.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "pickButton uses Button component with variant='primary'",
            "Button shows 'Select Image' text via title prop",
            "onPress handler calls onPickNewImage",
            "Visual appearance matches theme design system"
          ],
          "notes": "Remove pickButton and pickButtonText styles from StyleSheet"
        },
        {
          "subtask_id": "subtask-2-2",
          "title": "Replace AI extraction button with themed Button",
          "description": "Replace the 'Use AI to Extract Puzzle' TouchableOpacity with Button component. Use variant='primary' with a custom color or a new 'ai' variant. Handle loading state with Button's built-in loading prop.",
          "status": "completed",
          "completion_notes": "AI extraction button now uses Button component with variant='primary' and loading prop. Committed as b44f4ca.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "AI button uses Button component",
            "Loading state uses Button's loading prop instead of inline ActivityIndicator",
            "Disabled state handled via Button's disabled prop",
            "Button text changes between 'Use AI to Extract Puzzle' and loading text"
          ],
          "notes": "May need to pass loading text via title prop when loading=true, or extend Button component"
        },
        {
          "subtask_id": "subtask-2-3",
          "title": "Replace row/col control buttons with themed Buttons",
          "description": "Replace the +/- control buttons for rows and columns with Button components using variant='secondary' and size='small'.",
          "status": "completed",
          "completion_notes": "Row/col +/- buttons now use Button component with variant='secondary' size='small'. Removed controlButton and controlButtonText styles. Committed as 4915753.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "Control buttons use Button component with variant='secondary' size='small'",
            "Buttons show +/− symbols correctly",
            "onPress handlers call handleRowChange/handleColChange with correct delta",
            "Layout maintains horizontal alignment with row/col values"
          ],
          "notes": "Remove controlButton and controlButtonText styles from StyleSheet"
        },
        {
          "subtask_id": "subtask-2-4",
          "title": "Replace newImageButton with themed Button",
          "description": "Replace the 'Choose Different Image' link-style button with Button component using variant='ghost'.",
          "status": "completed",
          "completion_notes": "Replaced TouchableOpacity with Button component using variant='ghost'. Removed unused TouchableOpacity import and newImageButton/newImageButtonText styles. Committed as 5351713.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "newImageButton uses Button component with variant='ghost'",
            "Button shows 'Choose Different Image' text",
            "onPress handler calls onPickNewImage",
            "Visual appearance is link-like (no background, colored text)"
          ],
          "notes": "Remove newImageButton and newImageButtonText styles from StyleSheet"
        }
      ]
    },
    {
      "phase_id": "phase-3",
      "name": "Replace Text Components",
      "description": "Replace raw Text elements with themed typography components",
      "status": "completed",
      "subtasks": [
        {
          "subtask_id": "subtask-3-1",
          "title": "Replace static text with themed Text components",
          "description": "Replace all raw RN Text elements with themed Text, Body, Label, and Heading components. Map colors like #888 to theme color='secondary'.",
          "status": "completed",
          "completion_notes": "Replaced all raw RN Text elements with themed Body and Label components. Updated imports to include Body and Label from UI library. Mapped #888 color to color='secondary'. Cleaned up StyleSheet by removing color/fontSize properties now handled by themed components. Committed as 7a90b14.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "emptyText uses Body or Text component with color='secondary'",
            "controlLabel uses Label component with color='secondary'",
            "controlValue uses Body or Text component with appropriate weight",
            "hint text uses Body size='small' with color='secondary'",
            "aiHint uses Body size='small' with color='secondary'",
            "confidenceTitle uses Label component with appropriate styling"
          ],
          "notes": "Remove all text-related styles from StyleSheet that are now handled by themed components"
        }
      ]
    },
    {
      "phase_id": "phase-4",
      "name": "Use Card and Theme Tokens",
      "description": "Wrap sections in Card components and replace hardcoded colors with theme tokens",
      "status": "completed",
      "subtasks": [
        {
          "subtask_id": "subtask-4-1",
          "title": "Wrap confidence section in Card component",
          "description": "Replace the confidenceSection View with a Card component for consistent styling with the rest of the app.",
          "status": "completed",
          "completion_notes": "Replaced confidenceSection View with Card component from UI library. Removed duplicate styling (paddingHorizontal, paddingVertical, backgroundColor, borderRadius) now handled by Card component. Only marginTop: 16 remains for layout spacing. Committed as 9e10958.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "Confidence section uses Card component",
            "Card has appropriate variant (default or outlined)",
            "Content displays correctly with Card's built-in padding",
            "Visual consistency with other cards in the app"
          ],
          "notes": "Remove confidenceSection styles from StyleSheet"
        },
        {
          "subtask_id": "subtask-4-2",
          "title": "Replace hardcoded colors with theme tokens",
          "description": "Replace any remaining hardcoded colors (#007AFF, #9C27B0, #888, #333, #222, #000, #fff) with theme color tokens.",
          "status": "completed",
          "completion_notes": "Replaced all hardcoded hex colors with theme tokens: #007AFF → colors.accent.brass (edge handles), #9C27B0 → colors.accent.copper (AI button), #000 → colors.surface.obsidian (imageContainer), #1a1a1a → colors.surface.charcoal (stageConfidenceContainer), #333 → colors.surface.ash (borders), 'white' → colors.text.primary (SVG strokes), rgba colors → theme color + alpha suffix. Also replaced hardcoded borderRadius values with radii.lg and radii.md tokens, and some numeric margins with spacing tokens. Committed as 3a9af28.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-1-1"],
          "acceptance_criteria": [
            "No hardcoded hex colors remain in the component",
            "All colors reference theme tokens (colors.surface.*, colors.text.*, etc.)",
            "Visual appearance is consistent with app theme"
          ],
          "notes": "Import colors from theme, use colors.surface.obsidian, colors.text.secondary, etc."
        }
      ]
    },
    {
      "phase_id": "phase-5",
      "name": "Cleanup and Testing",
      "description": "Remove unused styles and verify the refactored component",
      "status": "completed",
      "subtasks": [
        {
          "subtask_id": "subtask-5-1",
          "title": "Remove unused StyleSheet styles",
          "description": "Clean up the StyleSheet by removing all styles that are now handled by themed components.",
          "status": "completed",
          "completion_notes": "Cleaned up StyleSheet by removing redundant styles: removed textAlign from controlValue (now uses Body align prop), removed textTransform from confidenceTitle and stageConfidenceTitle (handled by labelSmall variant), removed letterSpacing from stageConfidenceTitle, removed empty verticalEdge and horizontalEdge placeholder styles. Updated Body components to use align=\"center\" prop. Layout-only styles retained for positioning. Committed as 55c6fff.",
          "files_to_modify": [
            "pips-solver/src/app/screens/builder/Step1GridAlignment.tsx"
          ],
          "dependencies": ["subtask-2-1", "subtask-2-2", "subtask-2-3", "subtask-2-4", "subtask-3-1", "subtask-4-1", "subtask-4-2"],
          "acceptance_criteria": [
            "Removed: pickButton, pickButtonText styles",
            "Removed: controlButton, controlButtonText styles",
            "Removed: newImageButton, newImageButtonText styles",
            "Removed: aiButton, aiButtonDisabled, aiButtonLoading, aiButtonText styles",
            "Removed: emptyText, controlLabel, controlValue, hint, aiHint styles",
            "Removed: confidenceSection, confidenceTitle styles",
            "Only layout and positioning styles remain in StyleSheet"
          ],
          "notes": "Keep styles for container, content, imageContainer, image, controls, controlRow, edgeHandle, etc."
        },
        {
          "subtask_id": "subtask-5-2",
          "title": "Verify component functionality and appearance",
          "description": "Test all interactive elements and verify visual appearance matches the theme design system.",
          "status": "completed",
          "completion_notes": "Verification completed successfully: (1) All buttons use Button component with correct variants and handlers - Select Image (primary), AI Extract (primary with loading), +/- controls (secondary small), Choose Different Image (ghost). (2) Loading state uses Button's loading prop with aiProgress. (3) Row/col controls pass correct deltas to handleRowChange/handleColChange. (4) Body and Label components used with color='secondary' for hints. (5) Empty and loaded states render correctly. (6) TypeScript check passed with no errors. (7) No TouchableOpacity, no hardcoded hex colors, no console.log statements.",
          "files_to_modify": [],
          "dependencies": ["subtask-5-1"],
          "acceptance_criteria": [
            "All buttons respond to press events correctly",
            "Loading states work for AI extraction button",
            "Row/column controls increment and decrement correctly",
            "Text is readable with correct colors and fonts",
            "Component renders correctly in both empty and loaded states",
            "No TypeScript errors or warnings"
          ],
          "notes": "Manual testing or snapshot tests if available"
        }
      ]
    }
  ],
  "final_acceptance": [
    "Step1GridAlignment imports UI components from '../components/ui'",
    "No direct usage of TouchableOpacity for buttons",
    "No inline text styling - all text uses themed Text components",
    "No hardcoded color values - all colors from theme tokens",
    "StyleSheet only contains layout/positioning styles",
    "Component functionality is preserved (image selection, grid controls, AI extraction, cell tapping)",
    "Visual appearance is consistent with app design system"
  ]
}
