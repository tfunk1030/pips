# Build Progress: 003-add-extraction-comparison-diff-view

## Status: PLANNING COMPLETE

## Date: 2025-12-22

---

## Summary

Created detailed implementation plan for the Extraction Comparison/Diff View feature.
This feature will allow users to compare AI model extraction results side-by-side
with cell-by-cell disagreement analysis.

## Implementation Plan Overview

### Phase 1: Data Layer (95 min)
- Add debug response types to overlayTypes.ts
- Modify ensembleExtraction.ts to capture raw responses
- Thread debug responses through extraction pipeline

### Phase 2: Validation Layer (115 min)
- Create gridValidator.ts with cell comparison types
- Implement compareCellDetections function
- Add disagreement severity classification

### Phase 3: UI Layer (180 min)
- Create ExtractionComparisonModal component shell
- Build per-model result display section
- Add disagreement highlighting
- Add diff summary panel

### Phase 4: Integration (85 min)
- Add comparison button to AIVerificationModal
- Update OverlayBuilderScreen to pass debug data
- Add Settings toggle for debug mode

### Phase 5: Testing & Polish (110 min)
- Add unit tests for compareCellDetections
- Add error boundary and loading states
- Accessibility and responsive design

**Total Estimated: ~10 hours (585 minutes)**

## Key Discoveries

1. **ensembleExtraction.ts** - Multi-model extraction already queries models in parallel
   but does NOT store individual responses. Need to add rawResponses capture.

2. **AIVerificationModal.tsx** - Existing modal shows extraction preview.
   Will add "Compare Models" button here.

3. **No gridValidator.ts exists yet** - Need to create new file at
   pips-solver/src/services/extraction/validation/gridValidator.ts

4. **pips-solver code is on beautiful-williams branch** - Checked out to worktree

## Next Steps

1. Begin Phase 1.1: Add debug response types to overlayTypes.ts
2. Implement remaining subtasks in order

---

## Session Log

### 2025-12-22 - Planning Session
- [x] Read spec.md
- [x] Explored codebase structure
- [x] Checked out pips-solver from beautiful-williams branch
- [x] Analyzed existing extraction pipeline
- [x] Created implementation_plan.json with 5 phases, 15 subtasks
- [x] Recorded architectural discoveries
