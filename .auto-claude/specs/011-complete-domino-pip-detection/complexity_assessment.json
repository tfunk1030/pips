{
  "complexity": "standard",
  "workflow_type": "feature",
  "confidence": 0.85,
  "reasoning": "Computer vision task requiring specialized knowledge, but contained to single service (cv-service) with existing OpenCV infrastructure. Needs research for optimal CV approach (template matching, contour analysis, or ML) but scope is well-defined (3-8 files estimated). Accuracy is critical for downstream solver.",

  "analysis": {
    "scope": {
      "estimated_files": 6,
      "estimated_services": 1,
      "is_cross_cutting": false,
      "notes": "Contained to cv-service. Likely touches: pip detection implementation, test files, possibly API endpoint for pip detection, and helper utilities. Not cross-cutting since it's isolated to vision processing module."
    },
    "integrations": {
      "external_services": [],
      "new_dependencies": [],
      "research_needed": true,
      "notes": "OpenCV and NumPy already present in cv-service dependencies. No external APIs needed. Research required for optimal computer vision approach (template matching vs contour detection vs feature extraction vs ML models) to achieve rotation invariance and style/color robustness."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": false,
      "config_changes": false,
      "notes": "cv-service already has Docker infrastructure. No database changes needed. Possible minor config additions for CV algorithm parameters but not significant infrastructure work."
    },
    "knowledge": {
      "patterns_exist": true,
      "research_required": true,
      "unfamiliar_tech": [],
      "notes": "cv-service already uses OpenCV for other vision tasks (extract-geometry, crop-puzzle, crop-dominoes). However, pip detection is specialized CV work requiring research into best approaches for rotation-invariant pattern recognition. Incomplete implementation exists, so some patterns are present."
    },
    "risk": {
      "level": "medium",
      "concerns": [
        "Accuracy critical for puzzle solver correctness",
        "Rotation invariance adds algorithmic complexity",
        "Style/color variations require robust feature extraction",
        "Confidence scoring must accurately reflect detection reliability",
        "Edge cases: damaged pips, unusual lighting, occlusions"
      ],
      "notes": "Medium risk because pip detection accuracy directly impacts downstream solver. Incorrect detection means incorrect puzzle solutions, blocking user workflow. CV algorithms can be tricky to tune for robustness across different conditions."
    }
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "research",
    "context",
    "spec_writing",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": true,
    "needs_self_critique": false,
    "needs_infrastructure_setup": false
  },

  "validation_recommendations": {
    "risk_level": "medium",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration"],
    "security_scan_required": false,
    "staging_deployment_required": false,
    "reasoning": "Accuracy is critical for solver correctness. Requires unit tests for pip detection logic with various test images (rotations, styles, pip counts 0-6) and integration tests to verify API endpoint returns correct pip values with meaningful confidence scores. No security implications."
  },

  "created_at": "2025-12-22T00:00:00Z"
}
