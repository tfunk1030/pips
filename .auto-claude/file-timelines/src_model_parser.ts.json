{
  "file_path": "src/model/parser.ts",
  "main_branch_history": [],
  "task_views": {
    "004-add-cross-stage-confidence-warnings-to-ui": {
      "task_id": "004-add-cross-stage-confidence-warnings-to-ui",
      "branch_point": {
        "commit_hash": "faf3f69f9b2794c6a85ffd2581461d3d68bdf8ef",
        "content": "",
        "timestamp": "2025-12-22T03:09:58.791154"
      },
      "worktree_state": {
        "content": "import YAML from 'yaml';\nimport { PuzzleSpec, RegionConstraint } from './types';\n\nexport interface ParsedPuzzle {\n  puzzle: PuzzleSpec;\n  raw: any;\n}\n\nfunction normalizeConstraint(input: any): RegionConstraint {\n  if (!input) {\n    throw new Error('Missing region constraint');\n  }\n  if (input.sum !== undefined) {\n    return { type: 'sum', value: Number(input.sum), size: input.size };\n  }\n  if (input.op && input.value !== undefined) {\n    return { type: 'op', op: input.op, value: Number(input.value), size: input.size } as RegionConstraint;\n  }\n  if (input.all_equal) {\n    return { type: 'all_equal', size: input.size };\n  }\n  throw new Error(`Unknown constraint: ${JSON.stringify(input)}`);\n}\n\nexport function parsePuzzle(text: string): ParsedPuzzle {\n  const raw = YAML.parse(text);\n  if (!raw || typeof raw !== 'object') {\n    throw new Error('Invalid puzzle payload');\n  }\n  const rows = Number(raw.rows);\n  const cols = Number(raw.cols);\n  if (!rows || !cols) {\n    throw new Error('Puzzle must define rows and cols');\n  }\n  if (!Array.isArray(raw.regions) || raw.regions.length !== rows) {\n    throw new Error('regions must be a rows-length array');\n  }\n  const regions = raw.regions.map((row: any) => {\n    if (!Array.isArray(row) || row.length !== cols) {\n      throw new Error('Each regions row must match column length');\n    }\n    return row.map(Number);\n  });\n\n  const constraints: Record<number, RegionConstraint> = {};\n  if (!raw.regionConstraints || typeof raw.regionConstraints !== 'object') {\n    throw new Error('regionConstraints required');\n  }\n  Object.entries(raw.regionConstraints).forEach(([key, value]) => {\n    const id = Number(key);\n    constraints[id] = normalizeConstraint(value);\n  });\n\n  const puzzle: PuzzleSpec = {\n    name: raw.name,\n    rows,\n    cols,\n    regions,\n    regionConstraints: constraints,\n    maxPip: raw.maxPip ?? 6,\n    allowDuplicates: Boolean(raw.allowDuplicates),\n  };\n  return { puzzle, raw };\n}\n",
        "last_modified": "2025-12-22T03:10:02.248733"
      },
      "task_intent": {
        "title": "004-add-cross-stage-confidence-warnings-to-ui",
        "description": "Display the confidence hints generated by generateConfidenceHints() in the mobile app's extraction results screen. The backend already computes these hints but the UI only shows the overall confidence percentage.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-22T03:10:00.671580",
  "last_updated": "2025-12-22T03:10:00.767118"
}