{
  "file_path": "pips-solver/src/model/overlayTypes.ts",
  "main_branch_history": [],
  "task_views": {
    "005-add-image-stats-diagnostic-endpoint": {
      "task_id": "005-add-image-stats-diagnostic-endpoint",
      "branch_point": {
        "commit_hash": "faf3f69f9b2794c6a85ffd2581461d3d68bdf8ef",
        "content": "",
        "timestamp": "2025-12-22T03:09:16.372053"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "005-add-image-stats-diagnostic-endpoint",
        "description": "Create a _calculate_image_stats function and expose it as a standalone API endpoint that returns brightness, contrast, dynamic range, color balance, and saturation metrics without requiring preprocessing. This helps users diagnose image quality issues before extraction.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    },
    "007-step1gridalignment-should-use-themed-ui-components": {
      "task_id": "007-step1gridalignment-should-use-themed-ui-components",
      "branch_point": {
        "commit_hash": "faf3f69f9b2794c6a85ffd2581461d3d68bdf8ef",
        "content": "",
        "timestamp": "2025-12-22T03:10:00.281002"
      },
      "worktree_state": {
        "content": "/**\n * Types for the OverlayBuilder workflow\n * Used to create puzzles from screenshots via a 4-step wizard\n */\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Grid State (Step 1)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport interface GridBounds {\n  /** Percentage from left edge of image (0-100) */\n  left: number;\n  /** Percentage from top edge of image (0-100) */\n  top: number;\n  /** Percentage from left edge of image (0-100) */\n  right: number;\n  /** Percentage from top edge of image (0-100) */\n  bottom: number;\n}\n\nexport interface GridState {\n  rows: number;\n  cols: number;\n  bounds: GridBounds;\n  /** 2D array where true = hole (no cell), false = valid cell */\n  holes: boolean[][];\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Region State (Step 2)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport interface RegionPalette {\n  colors: string[];\n  labels: string[];\n  selectedIndex: number;\n}\n\nexport interface RegionState {\n  /** 2D array where null = hole, 0-9 = region index */\n  regionGrid: (number | null)[][];\n  palette: RegionPalette;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Constraint State (Step 3)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport type ConstraintType = 'none' | 'sum' | 'all_equal' | 'all_different';\nexport type ConstraintOp = '==' | '<' | '>' | '!=';\n\nexport interface ConstraintDef {\n  type: ConstraintType;\n  op?: ConstraintOp;\n  value?: number;\n}\n\nexport interface ConstraintState {\n  /** Map from region index to constraint definition */\n  regionConstraints: Record<number, ConstraintDef>;\n  selectedRegion: number | null;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Domino State (Step 4)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport type DominoPair = [number, number];\n\nexport interface DominoState {\n  dominoes: DominoPair[];\n  /** Expected count based on cell count / 2 */\n  expectedCount: number;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Overall Builder State\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport type BuilderStep = 1 | 2 | 3 | 4;\n\nexport interface ImageInfo {\n  uri: string;\n  width: number;\n  height: number;\n  base64?: string;\n}\n\nexport interface OverlayBuilderState {\n  step: BuilderStep;\n  image: ImageInfo | null;\n  grid: GridState;\n  regions: RegionState;\n  constraints: ConstraintState;\n  dominoes: DominoState;\n  draftId: string;\n  draftUpdatedAt: number;\n  /** AI extraction status */\n  aiStatus: 'idle' | 'extracting' | 'done' | 'error';\n  aiError?: string;\n  aiReasoning?: string;\n  /** AI confidence scores */\n  aiConfidence?: {\n    grid?: number;\n    regions?: number;\n    constraints?: number;\n    dominoes?: number;\n  };\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Builder Actions (for useReducer)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport type BuilderAction =\n  // Navigation\n  | { type: 'SET_STEP'; step: BuilderStep }\n  | { type: 'RESET' }\n  | { type: 'LOAD_DRAFT'; state: OverlayBuilderState }\n\n  // Image\n  | { type: 'SET_IMAGE'; image: ImageInfo }\n\n  // Grid (Step 1)\n  | { type: 'SET_GRID_BOUNDS'; bounds: GridBounds }\n  | { type: 'SET_ROWS'; rows: number }\n  | { type: 'SET_COLS'; cols: number }\n  | { type: 'TOGGLE_HOLE'; row: number; col: number }\n  | { type: 'RESIZE_GRID'; rows: number; cols: number }\n\n  // Regions (Step 2)\n  | { type: 'SELECT_PALETTE_COLOR'; index: number }\n  | { type: 'PAINT_CELL'; row: number; col: number }\n  | { type: 'CLEAR_REGION'; regionIndex: number }\n\n  // Constraints (Step 3)\n  | { type: 'SELECT_REGION'; regionIndex: number | null }\n  | { type: 'SET_CONSTRAINT'; regionIndex: number; constraint: ConstraintDef }\n  | { type: 'APPLY_CONSTRAINT_SHORTHAND'; shorthand: string }\n\n  // Dominoes (Step 4)\n  | { type: 'ADD_DOMINO'; pip1: number; pip2: number }\n  | { type: 'REMOVE_DOMINO'; index: number }\n  | { type: 'UPDATE_DOMINO'; index: number; pip1: number; pip2: number }\n  | { type: 'CYCLE_DOMINO_PIP'; dominoIndex: number; half: 0 | 1; direction: 1 | -1 }\n  | { type: 'SET_DOMINOES'; dominoes: DominoPair[] }\n  | { type: 'AUTO_FILL_DOMINOES' }\n\n  // AI Extraction\n  | { type: 'AI_START' }\n  | {\n      type: 'AI_SUCCESS';\n      grid: Partial<GridState>;\n      regions: Partial<RegionState>;\n      constraints: Partial<ConstraintState>;\n      dominoes: DominoPair[];\n      reasoning: string;\n      confidence?: {\n        grid?: number;\n        regions?: number;\n        constraints?: number;\n        dominoes?: number;\n      };\n    }\n  | { type: 'AI_ERROR'; error: string };\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Draft Recovery\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport interface DraftMeta {\n  draftId: string;\n  imageUri: string;\n  step: BuilderStep;\n  updatedAt: number;\n  rows: number;\n  cols: number;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// AI Extraction Types\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport interface BoardExtractionResult {\n  rows: number;\n  cols: number;\n  gridLocation?: {\n    left: number;\n    top: number;\n    right: number;\n    bottom: number;\n    imageWidth: number;\n    imageHeight: number;\n  };\n  shape: string;\n  regions: string;\n  constraints: Record<string, { type: string; op?: string; value?: number }>;\n  confidence?: {\n    grid: number;\n    regions: number;\n    constraints: number;\n  };\n}\n\nexport interface DominoExtractionResult {\n  dominoes: DominoPair[];\n  confidence?: number;\n}\n\nexport interface AIExtractionResult {\n  board: BoardExtractionResult;\n  dominoes: DominoExtractionResult;\n  reasoning: string;\n  confidence?: number;\n  confidenceScores?: {\n    grid?: number;\n    regions?: number;\n    constraints?: number;\n  };\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Default Values\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport const DEFAULT_PALETTE: RegionPalette = {\n  colors: [\n    '#FF9800', // A - Orange\n    '#009688', // B - Teal\n    '#9C27B0', // C - Purple\n    '#E91E63', // D - Pink\n    '#4CAF50', // E - Green\n    '#2196F3', // F - Blue\n    '#FF5722', // G - Deep Orange\n    '#607D8B', // H - Blue Gray\n    '#795548', // I - Brown\n    '#00BCD4', // J - Cyan\n  ],\n  labels: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'],\n  selectedIndex: 0,\n};\n\nexport const DEFAULT_GRID_BOUNDS: GridBounds = {\n  left: 10,\n  top: 10,\n  right: 90,\n  bottom: 80,\n};\n\nexport function createDefaultGridState(rows = 4, cols = 4): GridState {\n  return {\n    rows,\n    cols,\n    bounds: { ...DEFAULT_GRID_BOUNDS },\n    holes: Array(rows)\n      .fill(null)\n      .map(() => Array(cols).fill(false)),\n  };\n}\n\nexport function createDefaultRegionState(rows: number, cols: number): RegionState {\n  return {\n    regionGrid: Array(rows)\n      .fill(null)\n      .map(() => Array(cols).fill(0)),\n    palette: { ...DEFAULT_PALETTE },\n  };\n}\n\nexport function createDefaultConstraintState(): ConstraintState {\n  return {\n    regionConstraints: {},\n    selectedRegion: null,\n  };\n}\n\nexport function createDefaultDominoState(): DominoState {\n  return {\n    dominoes: [],\n    expectedCount: 0,\n  };\n}\n\nexport function createInitialBuilderState(): OverlayBuilderState {\n  return {\n    step: 1,\n    image: null,\n    grid: createDefaultGridState(),\n    regions: createDefaultRegionState(4, 4),\n    constraints: createDefaultConstraintState(),\n    dominoes: createDefaultDominoState(),\n    draftId: `draft_${Date.now()}`,\n    draftUpdatedAt: Date.now(),\n    aiStatus: 'idle',\n  };\n}\n",
        "last_modified": "2025-12-22T03:10:03.084354"
      },
      "task_intent": {
        "title": "007-step1gridalignment-should-use-themed-ui-components",
        "description": "Refactor Step1GridAlignment screen to use the established Button, Card, and Text components from the UI library instead of raw TouchableOpacity and inline StyleSheet styles. This improves consistency, accessibility, and maintainability.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-22T03:09:31.216009",
  "last_updated": "2025-12-22T03:10:02.144292"
}