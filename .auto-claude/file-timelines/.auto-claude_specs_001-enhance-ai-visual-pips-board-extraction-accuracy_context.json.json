{
  "file_path": ".auto-claude/specs/001-enhance-ai-visual-pips-board-extraction-accuracy/context.json",
  "main_branch_history": [],
  "task_views": {
    "005-add-image-stats-diagnostic-endpoint": {
      "task_id": "005-add-image-stats-diagnostic-endpoint",
      "branch_point": {
        "commit_hash": "faf3f69f9b2794c6a85ffd2581461d3d68bdf8ef",
        "content": "",
        "timestamp": "2025-12-22T03:09:16.372053"
      },
      "worktree_state": {
        "content": "{\n  \"task_description\": \"Enhance AI extraction accuracy for NYT Pips puzzle board with improved prompts, validation, CV preprocessing, and user verification UI\",\n  \"scoped_services\": [\"pips-solver\", \"cv-service\"],\n  \"files_to_modify\": {\n    \"pips-solver\": [\n      \"src/services/aiExtraction.ts\",\n      \"src/services/extraction/pipeline.ts\",\n      \"src/services/extraction/stages/gridGeometry.ts\",\n      \"src/services/extraction/stages/cellDetection.ts\",\n      \"src/services/extraction/stages/regionMapping.ts\",\n      \"src/services/extraction/stages/constraintExtraction.ts\",\n      \"src/services/extraction/stages/dominoExtraction.ts\",\n      \"src/services/extraction/validation/gridValidator.ts\",\n      \"src/services/cvExtraction.ts\",\n      \"src/app/components/AIVerificationModal.tsx\",\n      \"src/app/screens/OverlayBuilderScreen.tsx\"\n    ],\n    \"cv-service\": [\n      \"main.py\",\n      \"hybrid_extraction.py\"\n    ]\n  },\n  \"files_to_reference\": [\n    \"pips-solver/src/services/extractionSchemas.ts\",\n    \"pips-solver/src/services/jsonParsingUtils.ts\",\n    \"pips-solver/src/services/ensembleExtraction.ts\",\n    \"pips-solver/src/model/overlayTypes.ts\",\n    \"pips-solver/src/services/extraction/types.ts\",\n    \"pips-solver/src/services/extraction/config.ts\"\n  ],\n  \"patterns\": {\n    \"extraction_pipeline\": \"5-stage pipeline with context passing: Grid \u2192 Cells \u2192 Regions \u2192 Constraints \u2192 Dominoes\",\n    \"consensus_voting\": \"3-model ensemble with confidence-weighted voting (80% grid threshold, 70% regions)\",\n    \"zod_validation\": \"Use safeParse() for all AI responses with schema validation\",\n    \"json_parsing\": \"Use parseJSONWithFallback() to handle multiline strings in shape/regions\",\n    \"progress_callback\": \"Use ProgressCallback type to report stage progress with confidence scores\",\n    \"retry_logic\": \"Retry with clarifying prompt when models disagree or fewer than 2 valid responses\"\n  },\n  \"existing_implementations\": {\n    \"description\": \"Complete 5-stage extraction pipeline exists with multi-model ensemble. Issues: inaccurate grid detection, incorrect region mapping, constraint extraction failures, domino pip miscounting\",\n    \"relevant_files\": [\n      \"pips-solver/src/services/extraction/pipeline.ts\",\n      \"pips-solver/src/services/extraction/stages/gridGeometry.ts\",\n      \"pips-solver/src/services/extraction/stages/cellDetection.ts\",\n      \"pips-solver/src/services/extraction/stages/regionMapping.ts\",\n      \"pips-solver/src/services/extraction/stages/constraintExtraction.ts\",\n      \"pips-solver/src/services/extraction/stages/dominoExtraction.ts\"\n    ]\n  },\n  \"known_issues\": [\n    \"Grid dimension detection often incorrect (rows/cols swapped or miscounted)\",\n    \"Cell vs hole detection has false positives/negatives\",\n    \"Region color mapping fails with similar adjacent colors\",\n    \"Constraint extraction misses diamond labels or reads wrong values\",\n    \"Domino pip counting inaccurate especially for 4-6 pips\"\n  ],\n  \"tech_stack\": {\n    \"pips-solver\": {\n      \"language\": \"TypeScript\",\n      \"framework\": \"React Native + Expo SDK v54\",\n      \"libraries\": [\"expo-image-picker\", \"expo-file-system\", \"react-native-svg\", \"zod\"],\n      \"dev_command\": \"npm run start\",\n      \"port\": 8081\n    },\n    \"cv-service\": {\n      \"language\": \"Python\",\n      \"framework\": \"FastAPI\",\n      \"libraries\": [\"opencv-python\", \"numpy\", \"pydantic\"],\n      \"dev_command\": \"uvicorn main:app --host 0.0.0.0 --port 8080 --reload\",\n      \"port\": 8080\n    }\n  },\n  \"created_at\": \"2025-12-21T23:45:00.000Z\"\n}\n",
        "last_modified": "2025-12-22T03:30:38.597110"
      },
      "task_intent": {
        "title": "005-add-image-stats-diagnostic-endpoint",
        "description": "Create a _calculate_image_stats function and expose it as a standalone API endpoint that returns brightness, contrast, dynamic range, color balance, and saturation metrics without requiring preprocessing. This helps users diagnose image quality issues before extraction.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-22T03:09:17.251954",
  "last_updated": "2025-12-22T03:09:17.367832"
}